<svg width="800" height="500" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <text x="400" y="30" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle" fill="#1a1a1a">
    Traditional vs Zero-Copy (sendfile) File Transfer
  </text>

  <!-- Traditional Approach (Left Side) -->
  <g id="traditional">
    <!-- Label -->
    <text x="200" y="60" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#d9534f">
      Traditional Approach
    </text>

    <!-- Disk -->
    <rect x="120" y="80" width="160" height="60" fill="#f0f0f0" stroke="#333" stroke-width="2" rx="5"/>
    <text x="200" y="115" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">Disk</text>

    <!-- Arrow 1: Disk to Kernel Buffer -->
    <path d="M 200 140 L 200 170" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
    <text x="210" y="160" font-family="Arial, sans-serif" font-size="11" fill="#666">① Read</text>

    <!-- Kernel Buffer -->
    <rect x="120" y="170" width="160" height="50" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="200" y="200" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#1976d2">Kernel Buffer</text>

    <!-- Arrow 2: Kernel to User Space -->
    <path d="M 200 220 L 200 250" stroke="#d9534f" stroke-width="2" fill="none" marker-end="url(#arrowhead-red)"/>
    <text x="210" y="240" font-family="Arial, sans-serif" font-size="11" fill="#d9534f">② Copy to</text>
    <text x="210" y="252" font-family="Arial, sans-serif" font-size="11" fill="#d9534f">User Space</text>

    <!-- User Space Buffer -->
    <rect x="120" y="250" width="160" height="50" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="5"/>
    <text x="200" y="280" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#f57c00">User Space Buffer</text>
    <text x="200" y="294" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#999">(Python process)</text>

    <!-- Arrow 3: User Space to Socket Buffer -->
    <path d="M 200 300 L 200 330" stroke="#d9534f" stroke-width="2" fill="none" marker-end="url(#arrowhead-red)"/>
    <text x="210" y="320" font-family="Arial, sans-serif" font-size="11" fill="#d9534f">③ Copy to</text>
    <text x="210" y="332" font-family="Arial, sans-serif" font-size="11" fill="#d9534f">Socket</text>

    <!-- Socket Buffer -->
    <rect x="120" y="330" width="160" height="50" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="5"/>
    <text x="200" y="360" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#1976d2">Socket Buffer</text>

    <!-- Arrow 4: Socket to Network -->
    <path d="M 200 380 L 200 410" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
    <text x="210" y="400" font-family="Arial, sans-serif" font-size="11" fill="#666">④ Send</text>

    <!-- Network -->
    <rect x="120" y="410" width="160" height="60" fill="#f0f0f0" stroke="#333" stroke-width="2" rx="5"/>
    <text x="200" y="445" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">Network</text>

    <!-- Cost indicator -->
    <text x="200" y="490" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#d9534f">
      2 Extra Copies + Context Switches
    </text>
  </g>

  <!-- Zero-Copy Approach (Right Side) -->
  <g id="zerocopy">
    <!-- Label -->
    <text x="600" y="60" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#5cb85c">
      Zero-Copy (sendfile)
    </text>

    <!-- Disk -->
    <rect x="520" y="80" width="160" height="60" fill="#f0f0f0" stroke="#333" stroke-width="2" rx="5"/>
    <text x="600" y="115" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">Disk</text>

    <!-- Arrow 1: Disk to Page Cache -->
    <path d="M 600 140 L 600 200" stroke="#5cb85c" stroke-width="3" fill="none" marker-end="url(#arrowhead-green)"/>
    <text x="610" y="175" font-family="Arial, sans-serif" font-size="11" fill="#5cb85c">① Read to</text>
    <text x="610" y="187" font-family="Arial, sans-serif" font-size="11" fill="#5cb85c">Page Cache</text>

    <!-- Page Cache / DMA Buffer -->
    <rect x="520" y="200" width="160" height="70" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" rx="5"/>
    <text x="600" y="230" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#2e7d32">Kernel Page Cache</text>
    <text x="600" y="250" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#666">(DMA Buffer)</text>

    <!-- User Space Bypassed -->
    <rect x="520" y="290" width="160" height="50" fill="#fafafa" stroke="#ccc" stroke-width="1" stroke-dasharray="5,5" rx="5"/>
    <text x="600" y="315" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#999">User Space</text>
    <text x="600" y="330" font-family="Arial, sans-serif" font-size="11" text-anchor="middle" fill="#999">(Bypassed!)</text>

    <!-- Arrow 2: Direct to Network -->
    <path d="M 600 270 L 600 410" stroke="#5cb85c" stroke-width="3" fill="none" marker-end="url(#arrowhead-green)"/>
    <text x="610" y="345" font-family="Arial, sans-serif" font-size="11" fill="#5cb85c">② Direct</text>
    <text x="610" y="357" font-family="Arial, sans-serif" font-size="11" fill="#5cb85c">Transfer</text>

    <!-- Network -->
    <rect x="520" y="410" width="160" height="60" fill="#f0f0f0" stroke="#333" stroke-width="2" rx="5"/>
    <text x="600" y="445" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#333">Network</text>

    <!-- Benefit indicator -->
    <text x="600" y="490" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#5cb85c">
      No Extra Copies - All in Kernel!
    </text>
  </g>

  <!-- Arrow markers -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#333" />
    </marker>
    <marker id="arrowhead-red" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#d9534f" />
    </marker>
    <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#5cb85c" />
    </marker>
  </defs>

  <!-- Vertical divider line -->
  <line x1="400" y1="50" x2="400" y2="475" stroke="#ddd" stroke-width="2" stroke-dasharray="5,5"/>
</svg>
